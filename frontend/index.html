<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Village - Prototipo</title>
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <!-- Header / Navbar -->
    <header class="topbar">
      <div class="brand">
        <span class="logo">üè°</span>
        <h1>Village ‚Äî Gesti√≥n de Condominios</h1>
      </div>
      <!-- üîí Ocultar navegaci√≥n hasta que haya sesi√≥n -->
      <nav class="nav" data-role="any" style="display:none">
        <a href="#auth">Auth</a>
        <a href="#users">Usuarios</a>
        <a href="#data">Datos base</a>
        <a href="#reservations">Reservas</a>
        <a href="#tickets">Mantenimiento</a>
        <a href="#payments">Pagos</a>
      </nav>
    </header>

    <main class="container">
      <p class="muted center" data-role="any" style="display:none">
        Login ‚Üí Usuarios ‚Üí Reservas ‚Üí Mantenimiento ‚Üí Pagos (mock)
      </p>

      <!-- Banner sesi√≥n -->
      <section class="section" id="session-banner" style="display:none">
        <div class="card" style="display:flex;align-items:center;justify-content:space-between;gap:12px">
          <div>
            <strong id="sb-name">‚Äî</strong>
            <span class="muted">(<span id="sb-role">‚Äî</span>)</span>
          </div>
        </div>
      </section>

      <!-- 1) AUTENTICACI√ìN -->
      <section id="auth" class="section">
        <div class="row" style="place-items:center; min-height:40vh;">
          <div class="card" style="max-width:560px">
            <h3>Login</h3>
            <label>Email
              <input id="log-email" placeholder="correo@demo.com" />
              <small class="error" id="log-email-err"></small>
            </label>
            <label>Contrase√±a
              <input id="log-pass" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
              <small class="error" id="log-pass-err"></small>
            </label>
            <div class="actions">
              <button class="primary" onclick="login()">Entrar</button>
            </div>
            <pre id="log-out" class="output"></pre>
          </div>
        </div>
      </section>

      <!-- 2) USUARIOS -->
      <section id="users" class="section" data-role="admin-only" style="display:none">
        <h2>Usuarios</h2>
        <div class="row">
          <div class="card">
            <h3>Crear / Actualizar / Eliminar</h3>
            <div class="grid">
              <label>Nombre
                <input id="usr-name" placeholder="Nombre" />
                <small class="error" id="usr-name-err"></small>
              </label>
              <label>Email
                <input id="usr-email" type="email" placeholder="correo@demo.com" />
                <small class="error" id="usr-email-err"></small>
              </label>
              <label>Contrase√±a
                <input id="usr-pass" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
                <small class="error" id="usr-pass-err"></small>
              </label>
              <label>Rol
                <select id="usr-role">
                  <option value="resident" selected>resident</option>
                  <option value="admin">admin</option>
                </select>
                <small class="hint">* ‚Äúresident‚Äù se mapear√° a ‚Äúuser‚Äù.</small>
              </label>
              <label>ID (para editar/borrar)
                <input id="usr-id" type="number" min="1" placeholder="ej. 2" />
              </label>
            </div>

            <div class="actions wrap">
              <button onclick="createUser()">Crear usuario</button>
              <button onclick="listUsers()">Listar usuarios</button>
              <button onclick="updateUser()">Actualizar usuario (por ID)</button>
              <button class="danger" onclick="deleteUser()">Eliminar usuario (por ID)</button>
            </div>

            <!-- Resumen + lista bonita -->
            <div id="users-summary" class="muted small" style="margin:8px 0 10px 0"></div>
            <div id="users-list" class="cards-grid" style="margin-top:4px"></div>

            <!-- √Årea t√©cnica solo para errores -->
            <pre id="users-out" class="output" style="display:none"></pre>
          </div>
        </div>
      </section>

      <!-- 3) DATOS BASE -->
      <section id="data" class="section" data-role="admin-only" style="display:none">
        <h2>Datos base (admin)</h2>
        <div class="row">
          <div class="card">
            <h3>√Åreas comunes</h3>
            <label>Nombre de √°rea com√∫n
              <input id="amenity-name" placeholder="Ej: Sal√≥n Social" />
              <small class="error" id="amenity-err"></small>
            </label>
            <div class="actions">
              <button onclick="createAmenity()">Crear</button>
              <button class="ghost" onclick="listAmenities()">Listar</button>
            </div>

            <!-- Eliminar √°rea com√∫n -->
            <div class="grid" style="margin-top:8px">
              <label>ID de √°rea com√∫n (eliminar)
                <input id="amenity-id" type="number" min="1" placeholder="ej. 1" />
              </label>
            </div>
            <div class="actions">
              <button class="danger" onclick="deleteAmenity()">Eliminar √°rea com√∫n</button>
            </div>

            <pre id="amenities-out" class="output"></pre>
          </div>

          <div class="card">
            <h3>Crear Unidad</h3>
            <div class="grid">
              <label>C√≥digo de la unidad
                <input id="unit-code" placeholder="Ej: Torre A - 302" />
                <small class="error" id="unit-code-err"></small>
              </label>
              <label>Propietario (owner_id, opcional)
                <select id="unit-owner">
                  <option value="">‚Äî Selecciona propietario ‚Äî</option>
                </select>
              </label>
              <label>√Årea (m¬≤)
                <input id="unit-area" placeholder="ej. 72" />
                <small class="error" id="unit-area-err"></small>
              </label>
            </div>
            <div class="actions">
              <button onclick="createUnit()">Crear</button>
              <button class="ghost" onclick="listUnits()">Listar</button>
            </div>

            <!-- Eliminar unidad -->
            <div class="grid" style="margin-top:8px">
              <label>ID de unidad (para eliminar)
                <input id="unit-id" type="number" min="1" placeholder="ej. 3" />
              </label>
            </div>
            <div class="actions">
              <button class="danger" onclick="deleteUnit()">Eliminar unidad</button>
            </div>

            <!-- Resumen + lista bonita -->
            <div id="units-summary" class="muted small" style="margin:8px 0 10px 0"></div>
            <div id="units-list" class="cards-grid" style="margin-top:4px"></div>

            <!-- √Årea t√©cnica solo para errores -->
            <pre id="units-out" class="output" style="display:none"></pre>
          </div>
        </div>
      </section>

      <!-- 4) RESERVAS -->
      <section id="reservations" class="section" data-role="any" style="display:none">
        <h2>Reservas</h2>
        <div class="row">
          <div class="card">
            <h3>Nueva Reserva</h3>
            <div class="grid">
              <label>amenity_id
                <input id="res-amenity" placeholder="ej. 1" />
              </label>
              <label>user_id
                <input id="res-user" placeholder="ej. 2" />
              </label>
              <label>Inicio
                <input id="res-start" type="datetime-local" step="60" />
              </label>
              <label>Fin
                <input id="res-end" type="datetime-local" step="60" />
              </label>
            </div>
            <div class="actions">
              <button class="primary" onclick="createReservation()">Reservar</button>
            </div>
          </div>

          <!-- LISTADO remodelado -->
          <div class="card">
            <h3>Listado</h3>
            <div class="actions">
              <button class="ghost" onclick="listReservations()">Refrescar</button>
            </div>

            <!-- Resumen -->
            <div id="res-summary" class="muted" style="margin-bottom:8px"></div>

            <!-- Pr√≥ximas -->
            <h4 class="muted" id="res-upcoming-title" style="margin:6px 0">Pr√≥ximas</h4>
            <div id="res-upcoming" class="cards-grid"></div>

            <!-- Pasadas -->
            <h4 class="muted" id="res-past-title" style="margin:16px 0 6px; display:none">Pasadas</h4>
            <div id="res-past" class="cards-grid"></div>

            <!-- √Årea t√©cnica (oculta) para errores -->
            <pre id="reservations-out" class="output" style="display:none"></pre>
          </div>
        </div>
      </section>

      <!-- 5) MANTENIMIENTO -->
      <section id="tickets" class="section" data-role="any" style="display:none">
        <h2>Mantenimiento</h2>
        <div class="row">
          <!-- Nuevo Ticket -->
          <div class="card">
            <h3>Nuevo Ticket</h3>
            <div class="grid">
              <label>user_id
                <input id="tk-user" placeholder="ej. 2" />
              </label>
              <label>unit_id (opcional)
                <input id="tk-unit" placeholder="ej. 1" />
              </label>
              <label>T√≠tulo
                <input id="tk-title" placeholder="T√≠tulo" />
              </label>
              <label>Descripci√≥n
                <textarea id="tk-desc" placeholder="Descripci√≥n"></textarea>
              </label>
            </div>
            <div class="actions">
              <button onclick="createTicket()">Crear</button>
            </div>
          </div>

          <!-- Listado con tarjetas -->
          <div class="card">
            <div class="row" style="align-items:center; justify-content:space-between; gap:12px">
              <h3 style="margin:0">Listado</h3>
              <button class="ghost" onclick="listTickets()">Refrescar</button>
            </div>

            <!-- Resumen -->
            <div id="tickets-summary" class="muted" style="margin:8px 0 12px 0"></div>

            <!-- Aqu√≠ se pintan las tarjetas -->
            <div id="tickets-list" class="stack" style="gap:12px"></div>
          </div>
        </div>
      </section>

      <!-- 6) PAGOS -->
      <section id="payments" class="section" data-role="any" style="display:none">
        <h2>Pagos (mock)</h2>
        <div class="row">
          <!-- Nuevo Pago -->
          <div class="card">
            <h3>Nuevo Pago</h3>
            <div class="grid">
              <label>user_id
                <input id="pay-user" placeholder="ej. 2" />
              </label>
              <label>unit_id (opcional)
                <input id="pay-unit" placeholder="ej. 1" />
              </label>
              <label>Monto
                <input id="pay-amount" placeholder="ej. 150.000" />
              </label>
              <label>M√©todo
                <select id="pay-method">
                  <option value="card">card</option>
                  <option value="cash">cash</option>
                  <option value="transfer">transfer</option>
                </select>
              </label>
            </div>
            <div class="actions">
              <button onclick="createPayment()">Pagar</button>
            </div>
          </div>

          <!-- Historial (bonito, sin JSON) -->
          <div class="card">
            <h3>Historial</h3>

            <div class="actions" style="gap:8px">
              <button class="ghost" onclick="listPayments()">Refrescar</button>
              <span id="payments-summary" class="muted"></span>
            </div>

            <!-- Totales por m√©todo (solo admin) -->
            <div id="payments-methods" class="muted small" style="margin:8px 0"></div>

            <!-- Lista de pagos en tarjetas -->
            <div id="payments-list"></div>

            <!-- Campo t√©cnico oculto para errores -->
            <pre id="payments-out" class="output" style="display:none"></pre>

            <!-- Eliminar pago por ID -->
            <div class="grid" style="margin-top:12px">
              <label>ID de pago (eliminar)
                <input id="pay-id" type="number" min="1" placeholder="ej. 5" />
              </label>
            </div>
            <div class="actions">
              <button class="danger" onclick="deletePayment()">Eliminar pago</button>
            </div>
          </div>
        </div>
      </section>

      <section class="section center" data-role="any" style="display:none">
        <button class="chip" onclick="logout()">Cerrar sesi√≥n</button>
      </section>
    </main>

    <script src="./app.js?v=toast18"></script>
    <div id="toast" class="toast hidden"></div>
  </body>
</html>
